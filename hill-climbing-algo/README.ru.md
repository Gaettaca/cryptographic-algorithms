
## Дешифратор для текстов, зашифрованных с помощью "моноалфавитного шифра подстановки".

### Проблема.
**Моноалфавитный шифр подстановки (шифр простой замены)** — шифр, при котором каждый символ открытого текста заменяется на некоторый, фиксированный при данном ключе символ того же алфавита.  Например:
_ABCDEFGHIJKLMNOPQRSTUVWXYZ_ - алфавит открытого текста (незашифрованного).
_ZEBRASCDFGHIJKLMNOPQTUVWXY_ - алфавит шифр-текста(ключ), между алфавитом открытого текста и ключом взаимооднозначаное соответствие.

Моноалфавитные шифры легко вскрываются с использованием методов **_частотного анализа_** (атака на основе шифротекста).  
**Частотный анализ** использует гипотезу о том, что символы или последовательности символов в тексте имеют некоторое вероятностное распределение, которое сохраняется при шифровании и дешифровании. Этот метод один из самых простых и позволяет атаковать шифры простой замены, в которых символы в сообщении заменяются на другие согласно некоторому простому правилу соответствия.
Например, частотный анализ для шифр-текста в файле _src/encrypted/ct1.txt_,  где верхний график - частоты символов шифр-текста, а нижний - частоты букв английского алфавита.
<img src="https://user-images.githubusercontent.com/74289495/224504279-fbc18c91-2e30-4da9-bd28-4583e0a377b3.png" width=70% height=70%>
Недостатки этого метода заключаются в том, что на небольших шифр-текстах, вроде тех, что представлены в _src/encrypted/_, частоты символов шифр-текста и частоты букв английского алфавита могут не совпадать. Например, символ **K** в шифр-тексте не является зашифрованной буквой **T**. Есть способ улучшить частотный анализ: собирать частоты триграмм в шифр-тексте _(**триграмма** - любая последовательсность трёх букв, например: _THE_,  _AND_)._  
Самые часто встречающиеся триграммы:
|Trigram| Freq.|
|----|----|
| THE | 1.81%|
| AND | 0.73%|
| ING | 0.72%|
| ENT | 0.42%|

10 самых часто встречающихся триграмм в нашем шифр-тексте. 
<img src="https://user-images.githubusercontent.com/74289495/224537802-ed788775-a9be-4c03-a4d5-11ab938b3411.png" width=60% height=60%>

На основании частот символов и частот триграмм можно делать обоснованные предположения о том, что _DMP_ -> _THE_,   _UKL_ -> _AND_,  _BKC_ -> _ING_.
Аналогичным образом можно собрать частоты квадраграмм _(например: _TION_, _THAT_)_, что улучшит информативность частотного анализа и ускорит расшифровку текста.
Неоднозначность в соотвествии частот букв шифр-текста и букв открытого текста, триграмм и квадрограмм требует вмешательство криптоаналитика. 

### Как это работает.
Попробуем облегчить жизнь криптоаналитика автоматизировав расшифровку.
Очевидно, что для автоматизации нам нужен определенный алгоритм, использующий некую **_числовую характеристику_** нашего шифр-текста. То есть определенном шифр-тексту будет присвоено численное значение, например: _-3.34634122278_.
В качестве числовый характеристики возьмем **_осмысленность текста_**, например:
"ATTACK  AT  DOWN" - осмысленный текст; зашифруем его использую шифр простой замены.
"EXXEGO EX HSAR" - в осмысленности этого текста можно усомниться, бессмысленный набор букв.
Будем находить _осмысленность текста_, используя частотный анализ квадраграмм, так как квадраграмм значительно больше чем, триграмм и биграмм. А значит и информативность выше. 
Зная частоты квадраграмм, мы можем найти вероятность встретить ту или иную квадраграмму в нашем шифр-тексте. Чем менее осмысленный шифр-текст, тем дальше он от оригинала, и тем меньше вероятность найти в нем самые частые квадраграммы английского языка, и тем больше вероятность найти квадраграммы встречающиеся очень редко (или просто бессмысленные наборы из 4 букв, например: _QKPC_). 
_Мой опыт показывает, что частоты квадрограмм работают немного лучше, чем триграмм, триграмм - немного лучше, чем биграмм и т.д., но переход на частоты выше 4 букв не дает никакого преимущества._
**Подытожим:**
Числовая характеристика нашего текста _(осмысленность)_ - это произведение вероятностей каждой квадраграммы в нашем шифр-тексте. Например:
$$
p(ATTACK) = p(ATTA)  \times p(TTAC)  \times p(TACK)
$$
Где **_p(ATTA)_** - частота квадраграммы (искомая вероятность) в тексте, содержащем N квадраграмм.
$$
	p(ATTA) =  \frac{count(ATTA)}{N} 
$$
При перемножении множества малых вероятностей в числах с плавающей запятой может возникнуть переполнение, и как результат, потеря точности . По этой причине для каждой вероятности будем брать логарифм.

Используя хорошо известное тождество **_log(a*b) = log(a)+log(b)_**. Тогда итоговая логарифмированная вероятность имеет вид:
$$
\log(p(ATTACK)) = \log (p(ATTA)) + \log(p(TTAC))  + \log(p(TACK))
$$
Именно логарифмированная вероятность является _числовой характеристикой_ шифр-текста. Выходит, чем больше логарифмированная вероятность, тем выше осмысленность текста. Задача свелась к нахождению глобального максимума функции **_F(ct, key) -> score_**, где **_ct_** - шифр-текст, а **_key_** - ключ. Так как всего ключей 26! = 2^88, то простой перебор всех ключей займет очень много времени. Для оптимизация поиска будем использовать алгоритм ["поиск восхождением к вершине"](https://ru.wikipedia.org/wiki/Поиск_восхождением_к_вершине).
Приминительно к нашей задаче алгоритм будет выглядеть так:
1. Сгенерировать случайный ключ, называемый "родителем", расшифровать шифр-текст с помощью этого ключа. Оценить _осмысленность_ расшифрованного текста, сохранить результат.
2. Немного изменить ключ (рандомно поменять два символа в ключе местами), оценить _осмысленность_ расшифрованного текста с использованием нового ключа.
3. Если _осмысленность_ расшифрованного текста с измененным ключом выше, отбросисть старого "родителя" и сохранить измененный ключ в качестве нового "родителя".
4. Вернутся к пункту 2, если за последние 1000 итераций не произошло увелечения осмысленности.

Для шифр-текста в файле _src/encrypted/ct1.txt_ правильный ключ - _UESLPACMBNVIHKYJTFGDXWZOQR_ был получен меньше, чем за 1000 итераций, а осмысленность расшифрованного текста составила -2394, при начальной -11549
