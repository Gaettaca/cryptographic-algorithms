### Реализация модельной блочной криптосистемы Фейстеля в разных режимах шифрования. Анализ на надежность полученных шифртекстов с помощью статистического теста.


#### Теория.
Криптоcистема Фейстеля - один из методов построения блочных шифров. В ее основе лежат простые операции: XOR, побитовые циклические сдвиги, модульная арифметика. Сеть Фейстеля лежит в основе известных блочных шифров: DES, 3DES.  

В нашем случае объектом исследования станет модельная криптосистема Фейстеля (**криптоситема G**).  Криптосистема состоит из множества однотипных элементов - **ячеек Фейстеля**.
Формальное описание ячейки Фейсталя криптосистемы G:  $n_b = 16, d = 8,   \Theta = \{0 , 1\}^{32}, K = \{0, 1\}^{8}$ . Алгоритм KS ставит в соответствие ключу $\theta = \theta_1  || \theta_2  || \theta_3  || \theta_4, \theta_i = \{0, 1\}^{8}$ , последовательность тактовых ключей $\kappa_1 = \theta_1, \kappa_2 = \theta_2, \kappa_3 = \theta_3, \kappa_4 = \theta_4, \kappa_5 = \theta_1, \kappa_6 = \theta_2, \kappa_7 = \theta_3, \kappa_8 = \theta_4,$. В тактовой функции $f_k:\{0, 1\}^{8} \rightarrow \{0, 1\}^{8}$ используются модельные $S$-блоки $S_1$ и $S_2$. Тактовые функции действуют следующим образом: $f_k(x) = (S_1(z_1) || S_2(z_2)) \lll 3, z_i \in \{0, 1\}^{4},  z_1 || z_2 = x\oplus k$.

$S$-блоки $S_1$ и $S_2$ действуют по правилам:
1. $S_1(x) = ((3^xmod17) + 2)mod16)$;
2. $S_2(x) = ((5^xmod17) + 7)mod16)$;

Ниже схема ячейки Фейстеля криптосистемы G (1 такт).

<img src="https://user-images.githubusercontent.com/74289495/224772166-a39d4c78-bd00-40c5-bd54-5fea4037039b.png" width=40% height=40%>

Реализация ячейки Фейстеля для G:

<img src="https://user-images.githubusercontent.com/74289495/224828332-71bbd6b8-5e60-4241-851a-a6ac97f2dd1b.png" width=70% height=70%>

Криптосистема G обрабатывает за раз блок текста длиной в 16 бит. Существуют различные [режимы шифрования](https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation), позволяющие преобразовать последовательность блоков открытых данных в последовательность блоков зашифрованных данных.

Режимы шифрования используются для изменения процесса шифрования так, чтобы результат шифрования каждого блока был уникальным вне зависимости от шифруемых данных и не позволял сделать какие-либо выводы об их структуре. Это обусловлено, прежде всего, тем, что блочные шифры шифруют данные блоками фиксированного размера, и поэтому существует потенциальная возможность утечки информации о повторяющихся частях данных, шифруемых на одном и том же ключе.

Например, режим шифрования CBC:

<img src="https://user-images.githubusercontent.com/74289495/224823715-5b55620d-414a-4b79-bb23-8687d21740cf.png" width=70% height=70%>

Реализация режима шифрования CBC:

<img src="https://user-images.githubusercontent.com/74289495/224828828-c4b322a9-6481-46b2-bc24-ae0fc6a81e36.png" width=75% height=75%>

Реализацию многих других режимов шифрования можно найти в _./g-model.cpp, ./g-model.h_

#### Анализ шифр текста на надежность.
Для проверки криптосистемы на надежность надо уметь количественно оценивать шифр-текст на наличие каких-либо паттернов, повторений последовательностей бит. Для этого будем использовать статистический тест ["Approximate Entropy Test"](https://en.wikipedia.org/wiki/Approximate_entropy). Для этого теста мы собираем частоты встречаемости для _блоков длиной m бит и блоков длиной длиной m-1 бит_. Находим энтропию Шеннона для _m_ и _m-1_ отдельно. И находим значение неполной гамма-функции.
Для этого используется плюсовая библиотека **_boost_**.

Функция для нахождения энтропии Шеннона:

<img src="https://user-images.githubusercontent.com/74289495/224836504-5a87d022-da60-4fc3-9906-02efd7d0fe67.png" width=70% height=70%>

Реализация теста:

<img src="https://user-images.githubusercontent.com/74289495/224836769-34f16574-f5f3-42ff-8a32-46fb75383aba.png" width=70% height=70%>

Ниже проверка зашифрованного текстового файла на случайность. Как видно, криптосистема G не прошла проверку на надежность, так как **_igamc > 0.01_**. Причиной является модельность криптосистемы G и отсутствие нескольких элементов присущих надежным криптосистемам Фейстеля. Выводы: доработать внутренне строение ячейки Фейсте в  криптосистеме G. 

<img src="https://user-images.githubusercontent.com/74289495/224829453-c5ceb488-0c62-41b7-9a26-479d45febc02.png" width=30% height=30%>

